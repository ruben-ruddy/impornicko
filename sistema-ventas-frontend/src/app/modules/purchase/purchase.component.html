<!-- purchase.component.html -->
<div class="container mx-auto px-4 py-2">
    <h2 class="text-2xl font-bold mb-6 text-gray-800">Lista de Compras</h2> 
    
    <button (click)="openAddPurchaseModal()" class="bg-green-500 text-white px-4 py-2 rounded mb-4">
        Nueva Compra
    </button>

    <!-- Estado de carga -->
    @if (loading) {
    <div class="flex justify-center items-center h-64">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
        <span class="ml-3 text-gray-600">Cargando compras...</span>
    </div>
    }

    <!-- Estado de error -->
    @if (error && !loading) {
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        {{ error }}
    </div>
    }

    <!-- Tabla de compras -->
    @if (!loading && !error) {
    <div class="overflow-x-auto">
        <table class="min-w-full bg-white rounded-lg overflow-hidden">
            <thead class="bg-gray-100">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NÃºmero</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Comprador</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                @for (purchase of purchases; track purchase.id_compra) {
                <tr class="hover:bg-gray-100 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ purchase.numero_compra }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ purchase.fecha_compra | date:'short' }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ purchase.user?.nombre_usuario || 'N/A' }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-black">{{ purchase.total | currency }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <span [class]="getStatusClass(purchase.estado)">
                            {{ purchase.estado }}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <button (click)="openEditPurchaseModal(purchase)" class="text-blue-500 hover:text-blue-700 mr-2">
                            Editar
                        </button>
                        <button (click)="viewPurchaseDetails(purchase)" class="text-green-500 hover:text-green-700">
                            Ver Detalles
                        </button>
                    </td>
                </tr>
                } @empty {
                <tr>
                    <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">
                        No hay compras registradas
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>
    }
</div>