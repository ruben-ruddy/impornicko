<!-- modal-purchase.component.html -->
<div class="p-4 bg-white">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800">Nueva Compra</h2>
    <button (click)="close()" class="text-gray-500 hover:text-gray-700">
      <i class="pi pi-times text-xl"></i>
    </button>
  </div>
    <div class="">
        @if (view) {
          @if (catalogs.users.length === 0 || catalogs.products.length === 0) {
          <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4">
            <p>Error al cargar los catálogos. Por favor, recargue la página.</p>
            <button (click)="ngOnInit()" class="bg-yellow-500 text-white px-3 py-1 rounded mt-2">
              Reintentar
            </button>
          </div>
          }
          <dynamic-form
              [fields]="purchaseFormFields(catalogs)"
              [initialData]="initialData"
              [askfor]="onFormCreated"
              (onFormChange)="handleFormChange($event)">
          </dynamic-form>
        } @else {
        <div class="flex justify-center items-center h-64">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
            <span class="ml-3 text-gray-600">Cargando catálogos...</span>
        </div>
        }
    </div>
    <div class="flex justify-end mt-4">
        <button (click)="close()" class="bg-blue-500 text-white px-4 py-2 mr-4 hover:bg-blue-600 rounded-lg">Cancelar</button>
           
        <button (click)="save()"
               [disabled]="!formData?.valid || catalogs.users.length === 0 || catalogs.products.length === 0" 
               [ngClass]="formData?.valid && catalogs.users.length > 0 && catalogs.products.length > 0
                          ? 'bg-blue-500 text-white' 
                         : 'bg-gray-400 cursor-not-allowed'"
               class="px-4 py-2 rounded">
               {{ initialData.id_compra ? 'Actualizar' : 'Guardar' }}
        </button>
    </div>
</div>